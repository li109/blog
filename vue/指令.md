# Vue2.0源码阅读笔记（十）：指令
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 一、自定义指令
&emsp;&emsp;在Vue2.0 中，可以通过自定义指令对普通 DOM 元素进行底层操作。一个指令定义对象可以提供如下几个钩子函数：<br/>
> 1、bind：指令第一次绑定到元素时调用，只调用一次。<br/>
> 2、inserted：被绑定元素插入父节点时调用。<br/>
> 3、update：所在组件的VNode更新时调用。<br/>
> 4、componentUpdated：指令所在组件的VNode及其子VNode全部更新够调用。<br/>
> 5、unbind：指令与元素解绑时调用，只调用一次。<br/>

&emsp;&emsp;这里通过如下示例来阐述源码中对自定义指令的处理过程：<br/>
```js
<body>
  <div id="app"></div>
</body>
<script>
  let vm = new Vue({
    el: '#app',
    template: '<div>' +
      '<input v-focus>' +
      '</div>',
    directives: {
      focus: {
        inserted: function (el) {
          el.focus()
        }
      }
    }
  })
</script>
```
### 1、全局注册与局部注册
&emsp;&emsp;**指令**、**组件**和**过滤器**在Vue中称为**资源**。可以通过全局API进行全局注册，也可以通过具体选项进行局部注册。组件的全局注册和组件注册在[《组件》](https://juejin.im/post/5da42eb16fb9a04dfd267369)一文中详细阐述过，指令的处理与之类似，这里简要说明。<br/>
&emsp;&emsp;自定义指令全局注册的方法如下所示：<br/>
```js
Vue.directive = function (id, definition) {
  if (!definition) {
    return this.options.directives[id]
  } else {
    if (typeof definition === 'function') {
      definition = { bind: definition, update: definition };
    }
    Vue.options.directives[id] = definition;
    return definition
  }
}
```
&emsp;&emsp;Vue.directive 方法功能比较简单：将自定义指令的名字与配置对象转化成 Vue.options.directives 对象上的键值对。当配置对象为函数时，将该函数当成 bind 与 update 的钩子函数内容来处理，这是因为Vue提供了这种函数简写的方式，在[《选项合并》](https://juejin.im/post/5c8f60f8e51d45768a6e95f0)中有过详细阐述。<br/>
&emsp;&emsp;使用 directives 选项来注册指令，会将自定义指令信息存储在当前组件实例的 $options.directives 对象上。<br/>
### 2、模板编译
&emsp;&emsp;带有自定义指令的标签在生成AST时，会调用 processElement 方法对自定义指令进行处理。<br/>
```js
function processElement (element,options) {
  processKey(element);

  element.plain = (
    !element.key &&
    !element.scopedSlots &&
    !element.attrsList.length
  );

  processRef(element);
  processSlotContent(element);
  processSlotOutlet(element);
  processComponent(element);
  for (var i = 0; i < transforms.length; i++) {
    element = transforms[i](element, options) || element;
  }
  processAttrs(element);
  return element
}
```
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;实例中的模板经过编译后生成的渲染函数如下所示：<br/>
```js
_c(
  'div',
  [
    _c(
      'input',
      {
        directives:[
          {
            name:"focus",
            rawName:"v-focus"
          }
        ]
      }
    )
  ]
)
```
### 3、生成VNode
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
### 4、patch
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 二、数据绑定指令v-bind
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 三、事件指令v-on
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 四、循环指令v-for
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 五、条件指令
&emsp;&emsp;<br/>
### 1、v-if
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
### 1、v-show
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 六、双向绑定指令v-model
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
## 七、总结
&emsp;&emsp;<br/>
&emsp;&emsp;<br/>
